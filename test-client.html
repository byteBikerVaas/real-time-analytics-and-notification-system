<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Real-Time Analytics Dashboard</title>
    <style>
        body { font-family: 'Courier New', monospace; background: #222; color: #0f0; padding: 20px; }
        .card { border: 1px solid #444; padding: 20px; margin-bottom: 20px; border-radius: 8px; background: #111; }
        h1 { border-bottom: 1px solid #444; padding-bottom: 10px; }
        .metric-value { font-size: 4em; font-weight: bold; color: #fff; }
        .status { color: #888; font-size: 0.8em; margin-top: 5px; }
        .log-box { height: 300px; overflow-y: scroll; border: 1px solid #333; padding: 10px; background: #000; font-size: 0.9em; }
        .log-entry { margin-bottom: 5px; border-bottom: 1px dashed #333; padding-bottom: 2px; }
    </style>
</head>
<body>
    <h1>ðŸš€ Real-Time Analytics Pipeline</h1>

    <div class="card">
        <div>Active User ID: <strong style="color:cyan">user_benchmark</strong></div>
        <div style="margin-top:10px">Rolling Window Count (Last 1 Min):</div>
        <div id="countDisplay" class="metric-value">0</div>
        <div id="connectionStatus" class="status">ðŸ”´ Disconnected</div>
    </div>

    <h3>Stream Log</h3>
    <div id="logBox" class="log-box"></div>

    <script>
        // Connect to your WebSocket Gateway
        const userId = 'user_benchmark';
        const wsUrl = `ws://localhost:8082/ws/events?userId=${userId}`;
        const ws = new WebSocket(wsUrl);

        const statusEl = document.getElementById('connectionStatus');
        const countEl = document.getElementById('countDisplay');
        const logBox = document.getElementById('logBox');

        ws.onopen = () => {
            statusEl.innerText = 'ðŸŸ¢ Connected via WebSocket (Virtual Threads Active)';
            log("System Connected. Waiting for Aggregates...");
        };

        ws.onmessage = (event) => {
            try {
                const data = JSON.parse(event.data);
                // Update the Big Number
                countEl.innerText = data.count.toLocaleString();
                
                // Log to the console box
                const time = new Date(data.windowStart * 1000).toLocaleTimeString();
                log(`[${time}] Window Update: ${data.count} events`);
            } catch (e) {
                console.error("Parse error", e);
            }
        };

        ws.onclose = () => {
            statusEl.innerText = 'ðŸ”´ Disconnected';
            log("Connection Closed.");
        };

        function log(msg) {
            const div = document.createElement('div');
            div.className = 'log-entry';
            div.innerText = msg;
            logBox.prepend(div);
        }
    </script>
</body>
</html>