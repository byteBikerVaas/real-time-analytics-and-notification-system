<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Live System Dashboard</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #222; color: #fff; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        
        /* Status Bar */
        .status-bar { padding: 15px; border-radius: 8px; background: #333; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;}
        .status-indicator { font-weight: bold; color: #ff4444; }
        .connected { color: #00C851; }

        /* Logs Area */
        .log-container { background: #1e1e1e; height: 400px; overflow-y: auto; padding: 10px; border: 1px solid #444; border-radius: 5px; font-family: monospace; }
        .log-entry { padding: 8px; border-bottom: 1px solid #333; animation: fadeIn 0.3s ease-in; }
        .log-entry:first-child { background: #2a2a2a; border-left: 4px solid #00C851; } /* Highlight newest */
        
        .time { color: #888; margin-right: 10px; font-size: 0.8em; }
        .user { color: #33b5e5; font-weight: bold; }
        .event { color: #ffbb33; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="container">
    <div class="status-bar">
        <h2>ðŸš€ System Dashboard</h2>
        <div id="connection-status" class="status-indicator">ðŸ”´ Disconnected</div>
    </div>

    <h3>Live Event Stream (WebSocket)</h3>
    <div id="logs" class="log-container">
        <div style="color: #666; text-align: center; padding: 20px;">Waiting for events...</div>
    </div>
</div>

<script>
    const logContainer = document.getElementById('logs');
    const statusDiv = document.getElementById('connection-status');

    // 1. Connect to your Java Websocket Gateway
    const socket = new WebSocket("ws://localhost:8082/ws/events");

    socket.onopen = () => {
        statusDiv.innerText = "ðŸŸ¢ Connected to Java Backend";
        statusDiv.classList.add("connected");
        logContainer.innerHTML = ""; // Clear "waiting" message
    };

    socket.onmessage = (event) => {
        // 2. We received a JSON string from Kafka -> Java -> WebSocket
        const data = JSON.parse(event.data);
        
        // 3. Render it to HTML
        const entry = document.createElement("div");
        entry.className = "log-entry";
        entry.innerHTML = `
            <span class="time">${new Date().toLocaleTimeString()}</span>
            User <span class="user">${data.userId}</span> 
            triggered <span class="event">${data.eventType}</span>
        `;
        
        // Add to top of list
        logContainer.prepend(entry);
    };

    socket.onclose = () => {
        statusDiv.innerText = "ðŸ”´ Disconnected";
        statusDiv.classList.remove("connected");
    };
</script>

</body>
</html>